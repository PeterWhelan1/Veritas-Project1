<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Veritas AI — Values Survey (Ternary)</title>
  <meta name="description" content="Help us map how society prioritises Accountability, Community Safety, and Civil Liberties — today and in 2075." />
  <!-- Plotly.js CDN -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" defer></script>
  <style>
    :root { --bg: #0b1020; --fg: #e8ecf1; --muted: #9aa8b7; --card: #151c34; }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 2rem 1rem; }
    .card { background: var(--card); border-radius: 16px; padding: 1.25rem; box-shadow: 0 10px 30px rgba(0,0,0,.35); margin-bottom: 1rem; }
    h1, h2 { margin: .2rem 0 .6rem; }
    p { color: var(--muted); line-height: 1.6; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
    @media (min-width: 860px){ .grid { grid-template-columns: 1fr 1fr; } }
    .plot { width: 100%; height: 420px; }
    .tag { display:inline-block; padding:.25rem .5rem; border-radius: 999px; background:#26304f; color:#a9b8ff; font-size:.85rem; margin-right:.4rem; }
    button, input[type="submit"] { background:#4060ff; color:white; border:none; padding:.8rem 1rem; border-radius:10px; cursor:pointer; font-weight:600; }
    button:disabled, input[disabled]{ background:#2a2f45; cursor:not-allowed; }
    .small { font-size:.9rem; }
    .row { display:flex; align-items:center; gap:.75rem; flex-wrap:wrap; }
    .success { background:#16341e; color:#c1ffd0; padding:.7rem 1rem; border-radius:10px; display:none; }
    .error { background:#3a1a1a; color:#ffd1d1; padding:.7rem 1rem; border-radius:10px; display:none; }
    a { color:#a9b8ff; }
    .footer { opacity:.8; font-size:.85rem; margin-top:1rem; }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="card">
      <h1>Veritas AI — Values Survey</h1>
      <p>
        Our scenario explores <strong>public trust in policing</strong> and a system (Veritas AI) that flags potential misconduct while protecting privacy.
        Please mark how society prioritises these values <em>today</em> and in <em>2075</em>:
      </p>
      <div class="row">
        <span class="tag">Accountability & Oversight (A)</span>
        <span class="tag">Community Safety (B)</span>
        <span class="tag">Civil Liberties & Privacy (C)</span>
      </div>
      <p class="small">Click once in each triangle to set your values. Adjust before submitting.</p>
    </header>

    <main class="grid">
      <section class="card">
        <h2>Present (2025)</h2>
        <div id="plot-present" class="plot"></div>
        <p class="small" id="present-readout">Pick a point to set your dot.</p>
      </section>
      <section class="card">
        <h2>Future (2075)</h2>
        <div id="plot-future" class="plot"></div>
        <p class="small" id="future-readout">Pick a point to set your dot.</p>
      </section>
    </main>

    <form class="card" id="values-form" method="POST" action="https://formspree.io/f/xqagazql">
      <h2>Submit</h2>
      <p class="small">We only record your coordinates and a timestamp. No personal data is collected.</p>
      <input type="hidden" name="present_a" id="present_a" />
      <input type="hidden" name="present_b" id="present_b" />
      <input type="hidden" name="present_c" id="present_c" />
      <input type="hidden" name="future_a" id="future_a" />
      <input type="hidden" name="future_b" id="future_b" />
      <input type="hidden" name="future_c" id="future_c" />
      <input type="hidden" name="project" value="Veritas AI — MIS20070" />
      <div class="row">
        <label class="small"><input type="checkbox" id="consent" /> I confirm this is my single response.</label>
      </div>
      <div class="row">
        <input type="submit" id="submitBtn" value="Send my responses" disabled />
        <span class="small" id="status"></span>
      </div>
      <div id="ok" class="success">Thanks — your response was sent!</div>
      <div id="err" class="error">Something went wrong. Try again later.</div>
    </form>

    <footer class="card footer">
      <p>Values are intentionally in tension — there is no right answer.</p>
      <p class="small">If you use AI help, cite it: “Assistance received from Digital Society Assistant (GPT-5), OpenAI.”</p>
    </footer>
  </div>

  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <script>
    const STEP = 0.04;
    const STORAGE_KEY = 'veritas_values_submitted_v1';
    const REQUIRED = ['present_a','present_b','present_c','future_a','future_b','future_c'];

    function normalize(a,b){ let c = 1 - a - b; if(c<0){const s=a+b; a/=s; b/=s; c=0;} return [a,b,c]; }
    function makeGrid(){ const A=[],B=[],C=[]; for(let a=0;a<=1;a+=STEP){ for(let b=0;b<=1-a;b+=STEP){ const [aa,bb,cc]=normalize(a,b); A.push(aa);B.push(bb);C.push(cc);} } return {type:'scatterternary',a:A,b:B,c:C,mode:'markers',marker:{size:2,opacity:0.01},hoverinfo:'skip'}; }
    function makeUser(){ return {type:'scatterternary',a:[null],b:[null],c:[null],mode:'markers',marker:{size:10,color:'#4060ff'}}; }
    function layout(){ return {ternary:{sum:1,aaxis:{title:'A'},baxis:{title:'B'},caxis:{title:'C'}},margin:{l:20,r:20,b:20,t:20},showlegend:false}; }

    function initPlot(id,prefix){
      Plotly.newPlot(id,[makeGrid(),makeUser()],layout(),{displayModeBar:false});
      const el=document.getElementById(id);
      el.on('plotly_click',e=>{
        const p=e.points[0]; const a=p.a,b=p.b,c=p.c;
        Plotly.restyle(el,{a:[[a]],b:[[b]],c:[[c]]},[1]);
        document.getElementById(`${prefix}_a`).value=a.toFixed(3);
        document.getElementById(`${prefix}_b`).value=b.toFixed(3);
        document.getElementById(`${prefix}_c`).value=c.toFixed(3);
        document.getElementById(`${prefix}-readout`).textContent=`A=${(a*100).toFixed(1)}% • B=${(b*100).toFixed(1)}% • C=${(c*100).toFixed(1)}%`;
        updateButton();
      });
    }

    function updateButton(){
      const all=REQUIRED.every(id=>document.getElementById(id).value);
      const consent=document.getElementById('consent').checked;
      document.getElementById('submitBtn').disabled=!all||!consent||localStorage.getItem(STORAGE_KEY);
    }

    document.addEventListener('DOMContentLoaded',()=>{
      initPlot('plot-present','present');
      initPlot('plot-future','future');
      document.getElementById('consent').addEventListener('change',updateButton);
      document.getElementById('values-form').addEventListener('submit',async e=>{
        e.preventDefault();
        const data=new FormData(e.target);
        const res=await fetch(e.target.action,{method:'POST',body:data,headers:{'Accept':'application/json'}});
        if(res.ok){localStorage.setItem(STORAGE_KEY,'1');document.getElementById('ok').style.display='block';}
        else{document.getElementById('err').style.display='block';}
        updateButton();
      });
    });
  </script>
</body>
</html>
